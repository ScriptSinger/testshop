# Тестовое задание: Система заказов на Laravel

## Описание проекта

Простой сервис управления заказами с возможностью:

-   создания заказов с товарами;
-   проверки остатков на складе;
-   списания баланса клиента при подтверждении заказа.

## Стек технологий

-   PHP 8+
-   Laravel Framework 12.20.0
-   MySQL (через Docker Sail)
-   Docker (Sail для локального запуска)

## Установка и запуск

1. Клонируйте репозиторий:
   `git clone <URL_репозитория> cd <папка_проекта>`
2. Скопируйте `.env.example` в `.env` и настройте при необходимости параметры БД.
3. Запустите Sail (Docker):
   `./vendor/bin/sail up -d`
4. Выполните миграции и сиды:
   `./vendor/bin/sail artisan migrate --seed`

## API Эндпоинты

1. Список доступных товаров
   **Метод:** `GET`
   **URL:** `/api/catalog`
   **Описание:** Возвращает список доступных товаров.
2. Создание заказа
   **Метод:** POST
   **URL:** `/api/create-order`
   **Описание:** Создаёт заказ на основе переданных товаров и количества. При этом товары резервируются за покупателем.
   **Тело запроса:**
   `{
   "customer_id":1,
   "items":[
      {
         "product_id":3,
         "quantity":10
      },
      {
         "product_id":4,
         "quantity":5
      }
   ]
}`

3. Подтверждение заказа
   **Метод:** POST
   **URL:** /api/approve-order
   **Описание:** Подтверждает заказ: списывает баланс клиента и переводит заказ в статус approved.
   **Тело запроса:**
   ` {
    "order_id":101
}`

### Валидация

-   `customer_id` должен существовать в таблице клиентов
-   `product_id` должен существовать в таблице продуктов
-   `quantity` не должен превышать остаток на складе

## Особенности реализации

-   Вся бизнес-логика вынесена в сервис `OrderService`.
-   Используются транзакции для атомарности операций.
-   Валидация ошибок через `ValidationException`.
-   Модель `Order` связана с `OrderItem` через связь `items`.
-   Таблица `orders` содержит поле `number` для уникального номера заказа (можно убрать для упрощения).
-   Используется Laravel Sail для быстрой локальной докеризации.
-   Для упрощения валидация и бизнес-правила минимальны.
-   Тестовое задание рассчитано на проверку базовых навыков Laravel.
